# =============================================================================
# GRAPHQL SCHEMA
# Type definitions for Clients (may be symlink so that IDE can resolve types)
# =============================================================================
scalar Color # RGB(A) color code format (comma separate string or array of numbers)
scalar Email
scalar JSON
scalar Id # Incremental ID string generated based on Timestamp
scalar LanguageCode # language ISO code
scalar LanguageLevel # key/value pair of language code as `key`, and spoken fluency level as `value`
scalar LanguageLevelRange # key/value pair of language code as `key`, and range of spoken fluency levels as `value`
#scalar LocalString # this is better to be static type defined in project to allow querying speficic language
scalar Password # string with password strength validator
scalar Permissions # key/value pair of permission code as `key`, and boolean as `value` (example: {'1': true, '2': false})
scalar Phones # key/value pair of phone kind as `key`, and number as `value` (example: {'home': '+111', 'work': '+123'})
scalar Timestamp # in milliseconds since the Unix epoch
scalar URL # example: https://example.com
scalar Upload # built-in Graphql Type for File
enum Operator { # must be lower case values to match with MongoDB operators by default
    or
    and
}

# -----------------------------------------------------------------------------
# SUMMARY
# -----------------------------------------------------------------------------
type Query {
    cursor: JSON! # for querying large lists requiring pagination
}

type Mutation {
    _: String
}

type Subscription {
    alerts: [Alert!]!
}


# -----------------------------------------------------------------------------
# FILE UPLOADS
#
# @example:
#   type User {
#       photos: [File!]
#   }
#   input UserInput {
#       photos: [FileInput!]
#   }
#   >>> backend matches the same structure
# @example: Texture File {
#     src: /{...path}/{model}/{id}/{kind}_{i}.{ext}
#     kind: base/bump (or public/private)
#     i: 0/hd (or thumb/small/large)
#   }
#   Can yield 4 file versions with the same Texture Id:
#   >>> /uploads/Texture/Mdygx0NX0k/base_0.jpg
#   >>> /uploads/Texture/Mdygx0NX0k/base_hd.jpg
#   >>> /uploads/Texture/Mdygx0NX0k/bump_0.png
#   >>> /uploads/Texture/Mdygx0NX0k/bump_hd.png
#
#   Files can be grouped by Project:
#   >>> /uploads/Project/Mdygx0Noxx/Texture/Mdygx0NX0k/base_0.jpg
#   >>> /uploads/Project/Mdygx0Noxx/Mesh/Mdygx0NX0j/hd.glTF
#   >>> /uploads/Project/Mdygx0Noxx/Preview/Mdygx0NX0h/public.jpg
#   >>> /uploads/Project/Mdygx0Noxx/Csv/Mdygx0NX0i.csv
#
# Note: File type is flexible by design, and is to be used with these Components:
#   - <UploadGrid/>: list of a single or multiple file types of the same `kind`
#   - <UploadGrids/>: list of kinds, each with a single or multiple file types
#   => using FIELD definition, they automatically map File types from backend,
#       and autosave/query/mutate without manual setup in frontend.
#
# Validation:
#   - default `required` validator only checks that <UploadGrid/> has value
#   - specific identifier (i.e. 'HD' version of 'base' kind) requires custom validator
#
# Adhoc implementations:
#   - preview generated by backend automatically
#   - dimensions generated by backend automatically
# -----------------------------------------------------------------------------
# SETUP
# For defining `src` as ID
# @see: https://www.apollographql.com/docs/react/caching/cache-configuration/#typepolicy-fields
#   cache: new InMemoryCache({
#    typePolicies: {
#      File: {
#        keyFields: ['src'],
#      },
#    ...
# @note: `src` cannot be computed by frontend, because it does not control upload path
# -----------------------------------------------------------------------------
type File {
    # Computed by the server, or saved to db (the actual ID for GraphQL caching)
    src: URL!
    # Type of file (ex. public/private...)
    kind: JSON
    # Identifier or index position, stored by db (ex. thumb/small/large...)
    i: JSON
    # Optional - created Timestamp (better to use entry type ID).
    # `id` does no guarantee uniqueness, because different versions of the file can have the same `id`.
    id: Id
    # File name with extension for UI use and to get `ext` only, stored by db
    name: String
    creatorId: Id
    created: Timestamp # need this field because `id` may not exist (derived from entry type)
    updated: Timestamp
}

# built-in input `Upload` can be used directly with all `FileInput` attributes attached
input FileInput {
    # Binary File object uploaded from the client, required if `remove` is not true
    file: Upload
    # Type of file (ex. public/private...)
    kind: JSON
    # Identifier or index position, stored by db (ex. thumb/small/large...)
    i: JSON
    # Created Timestamp, can be used to unique identify the file
    id: Id
    # Whether to delete the file, it's called `remove` because `delete` is JS keyword
    remove: Boolean

    # Unused fields for Frontend convinience,
    # so GraphQL does not complain about extra fields
    #name: String # ignored during upload, uses GQL Upload.filename instead.
    #src: String
    #creatorId: Id
    #created: Timestamp
    #updated: Timestamp
}


# -----------------------------------------------------------------------------
# COMMON TYPES
# -----------------------------------------------------------------------------

type Action {
    type: String
    payload: JSON
    meta: JSON
    error: Boolean
}

type Alert {
    id: ID! # created Timestamp
    title: String!
    content: String!
}

type KeyVal {
    key: String
    val: JSON
}

input KeyValInput {
    key: String
    val: JSON
}

type Range {
    min: Int!
    max: Int
}

input RangeInput {
    min: Int!
    max: Int
}

type TimeRange {
    from: Timestamp
    to: Timestamp
}

input TimeRangeInput {
    from: Timestamp
    to: Timestamp
}
